{% set LogLevels = ['Debug', 'Info', 'Warning', 'Error', 'Critical'] %}

{% macro logScripts(execId) %}
<script type="text/javascript">
    const execId   = '{{ execId }}';
    const logLevels = {{ LogLevels|tojson }};

    function updateVisibilityFromStorage() {
        logLevels.forEach(level => {
            const key = `exec_${execId}_logVisible_${level}`;
            let vis = localStorage.getItem(key);
            if (vis === null) {
                vis = (level === 'Debug' ? 'false' : 'true');
                localStorage.setItem(key, vis);
            }
            if (vis === 'true') {
                $(".log" + level).removeClass("hidden");
                $("#button" + level).addClass("active").attr("aria-pressed","true");
            } else {
                $(".log" + level).addClass("hidden");
                $("#button" + level).removeClass("active").attr("aria-pressed","false");
            }
        });
    }

    $(document).ready(function() {
        updateVisibilityFromStorage();
        logLevels.forEach(level => {
            $(document).on('click', "#button" + level, function(){
                const key = `exec_${execId}_logVisible_${level}`;
                $(".log" + level).toggleClass("hidden");
                const isNowVisible = !$(".log" + level).first().hasClass("hidden");
                localStorage.setItem(key, isNowVisible);
            });
        });
    });
</script>
{% endmacro %}

{% macro logView(card, logInfo) %}
<div class="panel-heading" id="{{ card }}Header">
    <h2 class="panel-title">{{ card }} Log</h2>
</div>
<div class="panel-body" id="{{ card }}Log" style="background-color: #eaf5fb;">
    <div class="card-body" style="text-align:center">
        {% for level in LogLevels %}
            {% set count = logInfo.Count[level] %}
            <button id="button{{ level }}" data-toggle="button"
                    class="btn btn-darkBlue btn{{ level }} {% if level != 'Debug' %}active{% endif %}"
                    aria-pressed={{ "true" if level != 'Debug' else "false" }}>
                {{ level }}{% if count != 0 %} {{ count }}{% endif %}
            </button>
        {% endfor %}
    </div>
</div>

{% for level, line in logInfo.Log %}
<p style="padding-left: 10px"
   class="logLine log{{ level }} color{{ level }} {% if level=='Debug' %}hidden{% endif %}">
    {{ line }}
</p>
{% endfor %}
{% endmacro %}
